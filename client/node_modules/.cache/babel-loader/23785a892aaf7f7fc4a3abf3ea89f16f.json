{"ast":null,"code":"import _objectSpread from\"/Users/ganesh/Desktop/OMSCS/DBMS/Phase1/CS6400-2020-02-Team26/Phase_3/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/ganesh/Desktop/OMSCS/DBMS/Phase1/CS6400-2020-02-Team26/Phase_3/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Redirect,useLocation}from\"react-router-dom\";import{getData,sendData}from\"../services/api\";import{isLoggedIn}from\"../services/auth\";import{NavLinks}from\"../components\";var AddAdoption=function AddAdoption(){var locationState=useLocation().state;var _useState=useState({approvedApplicants:[],timeout:-1,latestApplication:{},dog:locationState&&locationState.dog,dateAdopted:\"\",dashboardRedirect:false,errorMessage:\"\",cookie:{}}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),approvedApplicantLastNameFragment=_useState4[0],setApprovedApplicantLastNameFragment=_useState4[1];// check auth\nuseEffect(function(){var cookie=isLoggedIn();if(cookie.hasOwnProperty(\"isTrustedVolunteer\")&&cookie.isTrustedVolunteer){setState(_objectSpread(_objectSpread({},state),{},{cookie:cookie}));}/* eslint-disable react-hooks/exhaustive-deps */},[]);// Don't pre-populate\n// useEffect(() => {\n//     if (state.cookie.hasOwnProperty(\"isTrustedVolunteer\") && state.cookie.isTrustedVolunteer) {\n//         getData(`/applicant?status=approved`)\n//             .then(({ target }) => {\n//                 setState({ ...state, approvedApplicants: JSON.parse(target.response) });\n//             })\n//             .catch(error => {\n//                 console.log(error);\n//             })\n//     }\n// }, [state.cookie]);\nvar getLatestApplication=function getLatestApplication(params,applicant){var query=Object.keys(params).filter(function(key){return params[key];}).map(function(key,index){return\"\".concat(index?\"&\":\"?\").concat(key,\"=\").concat(params[key]);}).join(\"\");getData(\"/application\".concat(query)).then(function(_ref){var target=_ref.target;if(target.status===200){var latestApplication=JSON.parse(target.response)[0];latestApplication.applicant=applicant;setState(_objectSpread(_objectSpread({},state),{},{latestApplication:latestApplication}));}else{console.log(target);}}).catch(function(error){console.log(error);});};var submitAdoption=function submitAdoption(){if(state.dateAdopted===\"\"){setState(_objectSpread(_objectSpread({},state),{},{errorMessage:\"Please enter adoption date.\"}));return;}var adoption={dateAdopted:state.dateAdopted,applicationNumberFk:+state.latestApplication.id,dogIdFk:state.dog.id};sendData(adoption,\"/adoption\").then(function(data){var target=data.target;if(target.status===201){// show success modal\nsetState(_objectSpread(_objectSpread({},state),{},{dashboardRedirect:true}));}else{console.log(\"error adding dog (non-201):\",target.response);setState(_objectSpread(_objectSpread({},state),{},{errorMessage:target.response}));}}).catch(function(error){// show error modal\nconsole.log(\"error adding dog (catch):\",error);setState(_objectSpread(_objectSpread({},state),{},{errorMessage:error}));});};var totalExpenses=state.dog&&state.dog.expenses.reduce(function(sum,current){return sum+current.amountInCents/100;},0);var animalControlPays=state.dog&&(state.dog.surrenderedByAnimalControl&&totalExpenses||0);var adoptionFee=1.15*totalExpenses-animalControlPays;var adoptionFeeCents=Math.round(adoptionFee%1*100);// round to nearest cent\nvar adoptionFeeDollars=Math.floor(adoptionFee);// round down to nearest dollar\nreturn/*#__PURE__*/React.createElement(React.Fragment,null,state.dashboardRedirect&&/*#__PURE__*/React.createElement(Redirect,{to:{pathname:\"/dog-dashboard\",state:{from:\"/add-adoption\"}}}),/*#__PURE__*/React.createElement(NavLinks,{isTrustedVolunteer:state.cookie.isTrustedVolunteer}),/*#__PURE__*/React.createElement(\"main\",{className:\"container\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Add Adoption\"),!state.latestApplication.id&&/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"approved-applicant-last-name\"},\"Search by approved applicant last name:\"),/*#__PURE__*/React.createElement(\"input\",{id:\"approved-applicant-last-name\",onChange:function onChange(_ref2){var target=_ref2.target;setApprovedApplicantLastNameFragment(target.value);clearTimeout(state.timeout);setState(_objectSpread(_objectSpread({},state),{},{timeout:setTimeout(function(){// make http call for approved applicants like\ngetData(\"/applicant?like=\".concat(target.value)).then(function(_ref3){var target=_ref3.target;var approvedApplicants=JSON.parse(target.response);if(target.status===200){setState(_objectSpread(_objectSpread({},state),{},{approvedApplicants:approvedApplicants}));}else{console.log(target);}}).catch(function(error){console.log(error);});},400)}));}}))),!state.latestApplication.id&&state.approvedApplicants.length>0&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h3\",null,\"Select Applicant\"),/*#__PURE__*/React.createElement(\"table\",null,/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null),/*#__PURE__*/React.createElement(\"th\",null,\"First Name\"),/*#__PURE__*/React.createElement(\"th\",null,\"Last Name\"),/*#__PURE__*/React.createElement(\"th\",null,\"Street\"),/*#__PURE__*/React.createElement(\"th\",null,\"City\"),/*#__PURE__*/React.createElement(\"th\",null,\"State\"),/*#__PURE__*/React.createElement(\"th\",null,\"Zip\"),/*#__PURE__*/React.createElement(\"th\",null,\"Email\"),/*#__PURE__*/React.createElement(\"th\",null,\"Phone Number\"),/*#__PURE__*/React.createElement(\"th\",null,\"Co-applicant Name\"))),/*#__PURE__*/React.createElement(\"tbody\",null,state.approvedApplicants.length>0&&state.approvedApplicants.map(function(applicant,index){if(applicant.coApplicantLastName){console.log(applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment));}return/*#__PURE__*/React.createElement(\"tr\",{key:index},/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:function onClick(){if(applicant.coApplicantLastName&&applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment)!==-1){getLatestApplication({applicantId:applicant.id,coApplicantFirstName:applicant.coApplicantFirstName,coApplicantLastName:applicant.coApplicantLastName},applicant);}else{getLatestApplication({applicantId:applicant.id},applicant);}}},\"Select\")),/*#__PURE__*/React.createElement(\"td\",null,applicant.firstName),/*#__PURE__*/React.createElement(\"td\",null,applicant.lastName),/*#__PURE__*/React.createElement(\"td\",null,applicant.street),/*#__PURE__*/React.createElement(\"td\",null,applicant.city),/*#__PURE__*/React.createElement(\"td\",null,applicant.state),/*#__PURE__*/React.createElement(\"td\",null,applicant.zip),/*#__PURE__*/React.createElement(\"td\",null,applicant.email),/*#__PURE__*/React.createElement(\"td\",null,applicant.phoneNumber),/*#__PURE__*/React.createElement(\"td\",null,applicant.coApplicantLastName&&applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment)!==-1?\"\".concat(applicant.coApplicantFirstName||\"\",\" \").concat(applicant.coApplicantLastName||\"\"):\"\"));})))),state.latestApplication.id&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h3\",null,\"Selected Application\"),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Application Number: \",state.latestApplication.id),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Date: \",new Date(state.latestApplication.date).toString()),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Applicant Name: \",state.latestApplication.applicant.firstName,\" \",state.latestApplication.applicant.lastName),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Applicant Address: \",state.latestApplication.applicant.street,\", \",state.latestApplication.applicant.city,\", \",state.latestApplication.applicant.state,\"  \",state.latestApplication.applicant.zipCode),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Email: \",state.latestApplication.applicant.email),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Phone Number: \",state.latestApplication.applicant.phoneNumber),(state.latestApplication.coApplicantFirstName||state.latestApplication.coApplicantLastName)&&/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},\"Co-Applicant: \",state.latestApplication.coApplicantFirstName,\" \",state.latestApplication.coApplicantLastName),/*#__PURE__*/React.createElement(\"h3\",null,\"Expenses\"),state.dog.expenses.map(function(expense){return/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\",key:expense.vendor+expense.date},/*#__PURE__*/React.createElement(\"div\",null,\"Vendor: \",expense.vendor),/*#__PURE__*/React.createElement(\"div\",null,\"Amount: $\",expense.amountInCents/100),/*#__PURE__*/React.createElement(\"div\",null,\"Description: \",expense.description),/*#__PURE__*/React.createElement(\"div\",null,\"Date: \",expense.date));}),/*#__PURE__*/React.createElement(\"h3\",null,\"Total Expenses: $\",totalExpenses),/*#__PURE__*/React.createElement(\"h3\",null,\"Animal Control pays: $\",animalControlPays),/*#__PURE__*/React.createElement(\"h3\",null,\"Adoption Fee: $\",adoptionFeeDollars,\".\",adoptionFeeCents),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"adoption-date\"},\"Adoption Date:\"),/*#__PURE__*/React.createElement(\"input\",{type:\"date\",onChange:function onChange(_ref4){var target=_ref4.target;return setState(_objectSpread(_objectSpread({},state),{},{dateAdopted:target.value}));}})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-unit\"},/*#__PURE__*/React.createElement(\"span\",null,\"I confirm every looks correct: \"),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:submitAdoption},\"Complete Adoption\"),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return setState(_objectSpread(_objectSpread({},state),{},{latestApplication:{},adoptionDate:\"\"}));}},\"Cancel\"),/*#__PURE__*/React.createElement(\"span\",{style:{color:\"red\",paddingLeft:\"10px\"}},state.errorMessage)))));};export default AddAdoption;","map":{"version":3,"sources":["/Users/ganesh/Desktop/OMSCS/DBMS/Phase1/CS6400-2020-02-Team26/Phase_3/client/src/containers/AddAdoption.js"],"names":["React","useEffect","useState","Redirect","useLocation","getData","sendData","isLoggedIn","NavLinks","AddAdoption","locationState","state","approvedApplicants","timeout","latestApplication","dog","dateAdopted","dashboardRedirect","errorMessage","cookie","setState","approvedApplicantLastNameFragment","setApprovedApplicantLastNameFragment","hasOwnProperty","isTrustedVolunteer","getLatestApplication","params","applicant","query","Object","keys","filter","key","map","index","join","then","target","status","JSON","parse","response","console","log","catch","error","submitAdoption","adoption","applicationNumberFk","id","dogIdFk","data","totalExpenses","expenses","reduce","sum","current","amountInCents","animalControlPays","surrenderedByAnimalControl","adoptionFee","adoptionFeeCents","Math","round","adoptionFeeDollars","floor","pathname","from","value","clearTimeout","setTimeout","length","coApplicantLastName","indexOf","applicantId","coApplicantFirstName","firstName","lastName","street","city","zip","email","phoneNumber","Date","date","toString","zipCode","expense","vendor","description","adoptionDate","color","paddingLeft"],"mappings":"qYAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,QAAT,CAAmBC,WAAnB,KAAsC,kBAAtC,CAEA,OAASC,OAAT,CAAkBC,QAAlB,KAAkC,iBAAlC,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,QAAT,KAAyB,eAAzB,CAEA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACtB,GAAMC,CAAAA,aAAa,CAAGN,WAAW,GAAGO,KAApC,CADsB,cAGIT,QAAQ,CAAC,CAC/BU,kBAAkB,CAAE,EADW,CAE/BC,OAAO,CAAE,CAAC,CAFqB,CAG/BC,iBAAiB,CAAE,EAHY,CAI/BC,GAAG,CAAEL,aAAa,EAAIA,aAAa,CAACK,GAJL,CAK/BC,WAAW,CAAE,EALkB,CAM/BC,iBAAiB,CAAE,KANY,CAO/BC,YAAY,CAAE,EAPiB,CAQ/BC,MAAM,CAAE,EARuB,CAAD,CAHZ,wCAGfR,KAHe,eAGRS,QAHQ,8BAc4DlB,QAAQ,CAAC,EAAD,CAdpE,yCAcfmB,iCAde,eAcoBC,oCAdpB,eAgBtB;AACArB,SAAS,CAAC,UAAM,CACZ,GAAMkB,CAAAA,MAAM,CAAGZ,UAAU,EAAzB,CACA,GAAIY,MAAM,CAACI,cAAP,CAAsB,oBAAtB,GAA+CJ,MAAM,CAACK,kBAA1D,CAA8E,CAC1EJ,QAAQ,gCAAMT,KAAN,MAAaQ,MAAM,CAANA,MAAb,GAAR,CACH,CACD,gDACH,CANQ,CAMN,EANM,CAAT,CAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,GAAMM,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACC,MAAD,CAASC,SAAT,CAAuB,CAChD,GAAMC,CAAAA,KAAK,CAAGC,MAAM,CAACC,IAAP,CAAYJ,MAAZ,EACTK,MADS,CACF,SAAAC,GAAG,QAAIN,CAAAA,MAAM,CAACM,GAAD,CAAV,EADD,EAETC,GAFS,CAEL,SAACD,GAAD,CAAME,KAAN,kBAAmBA,KAAK,CAAG,GAAH,CAAS,GAAjC,SAAuCF,GAAvC,aAA8CN,MAAM,CAACM,GAAD,CAApD,GAFK,EAGTG,IAHS,CAGJ,EAHI,CAAd,CAKA9B,OAAO,uBAAgBuB,KAAhB,EAAP,CACKQ,IADL,CACU,cAAgB,IAAbC,CAAAA,MAAa,MAAbA,MAAa,CAClB,GAAIA,MAAM,CAACC,MAAP,GAAkB,GAAtB,CAA2B,CACvB,GAAMxB,CAAAA,iBAAiB,CAAGyB,IAAI,CAACC,KAAL,CAAWH,MAAM,CAACI,QAAlB,EAA4B,CAA5B,CAA1B,CACA3B,iBAAiB,CAACa,SAAlB,CAA8BA,SAA9B,CACAP,QAAQ,gCAAMT,KAAN,MAAaG,iBAAiB,CAAjBA,iBAAb,GAAR,CACH,CAJD,IAIO,CACH4B,OAAO,CAACC,GAAR,CAAYN,MAAZ,EACH,CAEJ,CAVL,EAWKO,KAXL,CAWW,SAAAC,KAAK,CAAI,CACZH,OAAO,CAACC,GAAR,CAAYE,KAAZ,EACH,CAbL,EAcH,CApBD,CAsBA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CACzB,GAAInC,KAAK,CAACK,WAAN,GAAsB,EAA1B,CAA8B,CAC1BI,QAAQ,gCAAMT,KAAN,MAAaO,YAAY,CAAE,6BAA3B,GAAR,CACA,OACH,CAED,GAAM6B,CAAAA,QAAQ,CAAG,CACb/B,WAAW,CAAEL,KAAK,CAACK,WADN,CAEbgC,mBAAmB,CAAE,CAACrC,KAAK,CAACG,iBAAN,CAAwBmC,EAFjC,CAGbC,OAAO,CAAEvC,KAAK,CAACI,GAAN,CAAUkC,EAHN,CAAjB,CAKA3C,QAAQ,CAACyC,QAAD,CAAW,WAAX,CAAR,CACKX,IADL,CACU,SAAAe,IAAI,CAAI,IACFd,CAAAA,MADE,CACSc,IADT,CACFd,MADE,CAEV,GAAIA,MAAM,CAACC,MAAP,GAAkB,GAAtB,CAA2B,CACvB;AACAlB,QAAQ,gCAAMT,KAAN,MAAaM,iBAAiB,CAAE,IAAhC,GAAR,CACH,CAHD,IAGO,CACHyB,OAAO,CAACC,GAAR,CAAY,6BAAZ,CAA2CN,MAAM,CAACI,QAAlD,EACArB,QAAQ,gCAAMT,KAAN,MAAaO,YAAY,CAAEmB,MAAM,CAACI,QAAlC,GAAR,CACH,CACJ,CAVL,EAWKG,KAXL,CAWW,SAAAC,KAAK,CAAI,CACZ;AACAH,OAAO,CAACC,GAAR,CAAY,2BAAZ,CAAyCE,KAAzC,EACAzB,QAAQ,gCAAMT,KAAN,MAAaO,YAAY,CAAE2B,KAA3B,GAAR,CACH,CAfL,EAgBH,CA3BD,CA6BA,GAAMO,CAAAA,aAAa,CAAGzC,KAAK,CAACI,GAAN,EAAaJ,KAAK,CAACI,GAAN,CAAUsC,QAAV,CAAmBC,MAAnB,CAA0B,SAACC,GAAD,CAAMC,OAAN,QAAkBD,CAAAA,GAAG,CAAIC,OAAO,CAACC,aAAR,CAAwB,GAAjD,EAA1B,CAAiF,CAAjF,CAAnC,CAEA,GAAMC,CAAAA,iBAAiB,CAAG/C,KAAK,CAACI,GAAN,GAAeJ,KAAK,CAACI,GAAN,CAAU4C,0BAAV,EAAwCP,aAAzC,EAA2D,CAAzE,CAA1B,CAEA,GAAMQ,CAAAA,WAAW,CAAI,KAAOR,aAAR,CAAyBM,iBAA7C,CAEA,GAAMG,CAAAA,gBAAgB,CAAGC,IAAI,CAACC,KAAL,CAAYH,WAAW,CAAG,CAAf,CAAoB,GAA/B,CAAzB,CAA8D;AAE9D,GAAMI,CAAAA,kBAAkB,CAAGF,IAAI,CAACG,KAAL,CAAWL,WAAX,CAA3B,CAAoD;AAEpD,mBACI,wCACKjD,KAAK,CAACM,iBAAN,eAA2B,oBAAC,QAAD,EAAU,EAAE,CAAE,CAAEiD,QAAQ,CAAE,gBAAZ,CAA8BvD,KAAK,CAAE,CAAEwD,IAAI,CAAE,eAAR,CAArC,CAAd,EADhC,cAEI,oBAAC,QAAD,EAAU,kBAAkB,CAAExD,KAAK,CAACQ,MAAN,CAAaK,kBAA3C,EAFJ,cAGI,4BAAM,SAAS,CAAC,WAAhB,eACI,6CADJ,CAEK,CAACb,KAAK,CAACG,iBAAN,CAAwBmC,EAAzB,eAA+B,6CAC5B,2BAAK,SAAS,CAAC,WAAf,eACI,6BAAO,OAAO,CAAC,8BAAf,4CADJ,cAEI,6BACI,EAAE,CAAC,8BADP,CAEI,QAAQ,CAAE,wBAAgB,IAAbZ,CAAAA,MAAa,OAAbA,MAAa,CACtBf,oCAAoC,CAACe,MAAM,CAAC+B,KAAR,CAApC,CACAC,YAAY,CAAC1D,KAAK,CAACE,OAAP,CAAZ,CACAO,QAAQ,gCACDT,KADC,MACME,OAAO,CAAEyD,UAAU,CAAC,UAAM,CAChC;AACAjE,OAAO,2BAAoBgC,MAAM,CAAC+B,KAA3B,EAAP,CACKhC,IADL,CACU,eAAgB,IAAbC,CAAAA,MAAa,OAAbA,MAAa,CAClB,GAAIzB,CAAAA,kBAAkB,CAAG2B,IAAI,CAACC,KAAL,CAAWH,MAAM,CAACI,QAAlB,CAAzB,CACA,GAAIJ,MAAM,CAACC,MAAP,GAAkB,GAAtB,CAA2B,CACvBlB,QAAQ,gCAAMT,KAAN,MAAaC,kBAAkB,CAAlBA,kBAAb,GAAR,CACH,CAFD,IAGK,CACD8B,OAAO,CAACC,GAAR,CAAYN,MAAZ,EACH,CACJ,CATL,EAUKO,KAVL,CAUW,SAAAC,KAAK,CAAI,CACZH,OAAO,CAACC,GAAR,CAAYE,KAAZ,EACH,CAZL,EAaH,CAf4B,CAe1B,GAf0B,CADzB,GAAR,CAkBH,CAvBL,EAFJ,CAD4B,CAFpC,CAkCK,CAAClC,KAAK,CAACG,iBAAN,CAAwBmC,EAAzB,EAA+BtC,KAAK,CAACC,kBAAN,CAAyB2D,MAAzB,CAAkC,CAAjE,eACG,qDACI,iDADJ,cAEI,8CACI,8CACI,2CACI,8BADJ,cAEI,2CAFJ,cAGI,0CAHJ,cAII,uCAJJ,cAKI,qCALJ,cAMI,sCANJ,cAOI,oCAPJ,cAQI,sCARJ,cASI,6CATJ,cAUI,kDAVJ,CADJ,CADJ,cAeI,iCACK5D,KAAK,CAACC,kBAAN,CAAyB2D,MAAzB,CAAkC,CAAlC,EAAuC5D,KAAK,CAACC,kBAAN,CAAyBqB,GAAzB,CAA6B,SAACN,SAAD,CAAYO,KAAZ,CAAsB,CACvF,GAAIP,SAAS,CAAC6C,mBAAd,CAAmC,CAC/B9B,OAAO,CAACC,GAAR,CAAYhB,SAAS,CAAC6C,mBAAV,CAA8BC,OAA9B,CAAsCpD,iCAAtC,CAAZ,EACH,CAED,mBACI,0BAAI,GAAG,CAAEa,KAAT,eACI,2CACI,8BAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAE,kBAAM,CACjC,GAAIP,SAAS,CAAC6C,mBAAV,EAAiC7C,SAAS,CAAC6C,mBAAV,CAA8BC,OAA9B,CAAsCpD,iCAAtC,IAA6E,CAAC,CAAnH,CAAsH,CAClHI,oBAAoB,CAAC,CAAEiD,WAAW,CAAE/C,SAAS,CAACsB,EAAzB,CAA6B0B,oBAAoB,CAAEhD,SAAS,CAACgD,oBAA7D,CAAmFH,mBAAmB,CAAE7C,SAAS,CAAC6C,mBAAlH,CAAD,CAA0I7C,SAA1I,CAApB,CACH,CAFD,IAEO,CACHF,oBAAoB,CAAC,CAAEiD,WAAW,CAAE/C,SAAS,CAACsB,EAAzB,CAAD,CAAgCtB,SAAhC,CAApB,CACH,CACJ,CAND,WADJ,CADJ,cAUI,8BAAKA,SAAS,CAACiD,SAAf,CAVJ,cAWI,8BAAKjD,SAAS,CAACkD,QAAf,CAXJ,cAYI,8BAAKlD,SAAS,CAACmD,MAAf,CAZJ,cAaI,8BAAKnD,SAAS,CAACoD,IAAf,CAbJ,cAcI,8BAAKpD,SAAS,CAAChB,KAAf,CAdJ,cAeI,8BAAKgB,SAAS,CAACqD,GAAf,CAfJ,cAgBI,8BAAKrD,SAAS,CAACsD,KAAf,CAhBJ,cAiBI,8BAAKtD,SAAS,CAACuD,WAAf,CAjBJ,cAkBI,8BAAMvD,SAAS,CAAC6C,mBAAV,EAAiC7C,SAAS,CAAC6C,mBAAV,CAA8BC,OAA9B,CAAsCpD,iCAAtC,IAA6E,CAAC,CAAhH,WAAwHM,SAAS,CAACgD,oBAAV,EAAkC,EAA1J,aAAgKhD,SAAS,CAAC6C,mBAAV,EAAiC,EAAjM,EAAwM,EAA7M,CAlBJ,CADJ,CAuBH,CA5BuC,CAD5C,CAfJ,CAFJ,CAnCR,CAuFK7D,KAAK,CAACG,iBAAN,CAAwBmC,EAAxB,eACG,qDACI,qDADJ,cAEI,2BAAK,SAAS,CAAC,WAAf,yBAAgDtC,KAAK,CAACG,iBAAN,CAAwBmC,EAAxE,CAFJ,cAGI,2BAAK,SAAS,CAAC,WAAf,WAAkC,GAAIkC,CAAAA,IAAJ,CAASxE,KAAK,CAACG,iBAAN,CAAwBsE,IAAjC,EAAuCC,QAAvC,EAAlC,CAHJ,cAII,2BAAK,SAAS,CAAC,WAAf,qBAA4C1E,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCiD,SAA9E,KAA0FjE,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCkD,QAA5H,CAJJ,cAKI,2BAAK,SAAS,CAAC,WAAf,wBAA+ClE,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCmD,MAAjF,MAA2FnE,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCoD,IAA7H,MAAqIpE,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkChB,KAAvK,MAAgLA,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkC2D,OAAlN,CALJ,cAMI,2BAAK,SAAS,CAAC,WAAf,YAAmC3E,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCsD,KAArE,CANJ,cAOI,2BAAK,SAAS,CAAC,WAAf,mBAA0CtE,KAAK,CAACG,iBAAN,CAAwBa,SAAxB,CAAkCuD,WAA5E,CAPJ,CAQK,CAACvE,KAAK,CAACG,iBAAN,CAAwB6D,oBAAxB,EAAgDhE,KAAK,CAACG,iBAAN,CAAwB0D,mBAAzE,gBAAiG,2BAAK,SAAS,CAAC,WAAf,mBAA0C7D,KAAK,CAACG,iBAAN,CAAwB6D,oBAAlE,KAAyFhE,KAAK,CAACG,iBAAN,CAAwB0D,mBAAjH,CARtG,cASI,yCATJ,CAUK7D,KAAK,CAACI,GAAN,CAAUsC,QAAV,CAAmBpB,GAAnB,CAAuB,SAAAsD,OAAO,qBAC3B,2BAAK,SAAS,CAAC,WAAf,CAA2B,GAAG,CAAEA,OAAO,CAACC,MAAR,CAAiBD,OAAO,CAACH,IAAzD,eACI,0CAAcG,OAAO,CAACC,MAAtB,CADJ,cAEI,2CAAeD,OAAO,CAAC9B,aAAR,CAAwB,GAAvC,CAFJ,cAGI,+CAAmB8B,OAAO,CAACE,WAA3B,CAHJ,cAII,wCAAYF,OAAO,CAACH,IAApB,CAJJ,CAD2B,EAA9B,CAVL,cAkBI,kDAAsBhC,aAAtB,CAlBJ,cAmBI,uDAA2BM,iBAA3B,CAnBJ,cAoBI,gDAAoBM,kBAApB,KAAyCH,gBAAzC,CApBJ,cAqBI,4CACI,6BAAO,OAAO,CAAC,eAAf,mBADJ,cAEI,6BAAO,IAAI,CAAC,MAAZ,CAAmB,QAAQ,CAAE,4BAAGxB,CAAAA,MAAH,OAAGA,MAAH,OAAgBjB,CAAAA,QAAQ,gCAAMT,KAAN,MAAaK,WAAW,CAAEqB,MAAM,CAAC+B,KAAjC,GAAxB,EAA7B,EAFJ,CArBJ,cAyBI,2BAAK,SAAS,CAAC,WAAf,eACI,kEADJ,cACgD,8BAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAEtB,cAA/B,sBADhD,cACyH,8BAAQ,IAAI,CAAC,QAAb,CAAsB,OAAO,CAAE,yBAAM1B,CAAAA,QAAQ,gCAAMT,KAAN,MAAaG,iBAAiB,CAAE,EAAhC,CAAoC4E,YAAY,CAAE,EAAlD,GAAd,EAA/B,WADzH,cAC8O,4BAAM,KAAK,CAAE,CAAEC,KAAK,CAAE,KAAT,CAAgBC,WAAW,CAAE,MAA7B,CAAb,EAAqDjF,KAAK,CAACO,YAA3D,CAD9O,CAzBJ,CAxFR,CAHJ,CADJ,CA+HH,CAlOD,CAoOA,cAAeT,CAAAA,WAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Redirect, useLocation } from \"react-router-dom\";\n\nimport { getData, sendData } from \"../services/api\";\nimport { isLoggedIn } from \"../services/auth\";\nimport { NavLinks } from \"../components\";\n\nconst AddAdoption = () => {\n    const locationState = useLocation().state;\n\n    const [state, setState] = useState({\n        approvedApplicants: [],\n        timeout: -1,\n        latestApplication: {},\n        dog: locationState && locationState.dog,\n        dateAdopted: \"\",\n        dashboardRedirect: false,\n        errorMessage: \"\",\n        cookie: {}\n    });\n\n    const [approvedApplicantLastNameFragment, setApprovedApplicantLastNameFragment] = useState(\"\");\n\n    // check auth\n    useEffect(() => {\n        const cookie = isLoggedIn();\n        if (cookie.hasOwnProperty(\"isTrustedVolunteer\") && cookie.isTrustedVolunteer) {\n            setState({ ...state, cookie });\n        }\n        /* eslint-disable react-hooks/exhaustive-deps */\n    }, []);\n\n    // Don't pre-populate\n    // useEffect(() => {\n    //     if (state.cookie.hasOwnProperty(\"isTrustedVolunteer\") && state.cookie.isTrustedVolunteer) {\n    //         getData(`/applicant?status=approved`)\n    //             .then(({ target }) => {\n    //                 setState({ ...state, approvedApplicants: JSON.parse(target.response) });\n    //             })\n    //             .catch(error => {\n    //                 console.log(error);\n    //             })\n    //     }\n    // }, [state.cookie]);\n\n    const getLatestApplication = (params, applicant) => {\n        const query = Object.keys(params)\n            .filter(key => params[key])\n            .map((key, index) => `${index ? \"&\" : \"?\"}${key}=${params[key]}`)\n            .join(\"\")\n\n        getData(`/application${query}`)\n            .then(({ target }) => {\n                if (target.status === 200) {\n                    const latestApplication = JSON.parse(target.response)[0]\n                    latestApplication.applicant = applicant;\n                    setState({ ...state, latestApplication });\n                } else {\n                    console.log(target);\n                }\n\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    const submitAdoption = () => {\n        if (state.dateAdopted === \"\") {\n            setState({ ...state, errorMessage: \"Please enter adoption date.\" });\n            return;\n        }\n\n        const adoption = {\n            dateAdopted: state.dateAdopted,\n            applicationNumberFk: +state.latestApplication.id,\n            dogIdFk: state.dog.id\n        }\n        sendData(adoption, \"/adoption\")\n            .then(data => {\n                const { target } = data;\n                if (target.status === 201) {\n                    // show success modal\n                    setState({ ...state, dashboardRedirect: true });\n                } else {\n                    console.log(\"error adding dog (non-201):\", target.response);\n                    setState({ ...state, errorMessage: target.response });\n                }\n            })\n            .catch(error => {\n                // show error modal\n                console.log(\"error adding dog (catch):\", error);\n                setState({ ...state, errorMessage: error });\n            });\n    }\n\n    const totalExpenses = state.dog && state.dog.expenses.reduce((sum, current) => sum + (current.amountInCents / 100), 0);\n\n    const animalControlPays = state.dog && ((state.dog.surrenderedByAnimalControl && totalExpenses) || 0);\n\n    const adoptionFee = (1.15 * totalExpenses) - animalControlPays;\n\n    const adoptionFeeCents = Math.round((adoptionFee % 1) * 100); // round to nearest cent\n\n    const adoptionFeeDollars = Math.floor(adoptionFee); // round down to nearest dollar\n\n    return (\n        <>\n            {state.dashboardRedirect && <Redirect to={{ pathname: \"/dog-dashboard\", state: { from: \"/add-adoption\" } }} />}\n            <NavLinks isTrustedVolunteer={state.cookie.isTrustedVolunteer} />\n            <main className=\"container\">\n                <h1>Add Adoption</h1>\n                {!state.latestApplication.id && <form>\n                    <div className=\"form-unit\">\n                        <label htmlFor=\"approved-applicant-last-name\">Search by approved applicant last name:</label>\n                        <input\n                            id=\"approved-applicant-last-name\"\n                            onChange={({ target }) => {\n                                setApprovedApplicantLastNameFragment(target.value);\n                                clearTimeout(state.timeout);\n                                setState({\n                                    ...state, timeout: setTimeout(() => {\n                                        // make http call for approved applicants like\n                                        getData(`/applicant?like=${target.value}`)\n                                            .then(({ target }) => {\n                                                let approvedApplicants = JSON.parse(target.response);\n                                                if (target.status === 200) {\n                                                    setState({ ...state, approvedApplicants });\n                                                }\n                                                else {\n                                                    console.log(target);\n                                                }\n                                            })\n                                            .catch(error => {\n                                                console.log(error);\n                                            })\n                                    }, 400)\n                                });\n                            }}\n                        />\n                    </div>\n\n                </form>}\n\n                {!state.latestApplication.id && state.approvedApplicants.length > 0 && (\n                    <>\n                        <h3>Select Applicant</h3>\n                        <table>\n                            <thead>\n                                <tr>\n                                    <th></th>\n                                    <th>First Name</th>\n                                    <th>Last Name</th>\n                                    <th>Street</th>\n                                    <th>City</th>\n                                    <th>State</th>\n                                    <th>Zip</th>\n                                    <th>Email</th>\n                                    <th>Phone Number</th>\n                                    <th>Co-applicant Name</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {state.approvedApplicants.length > 0 && state.approvedApplicants.map((applicant, index) => {\n                                    if (applicant.coApplicantLastName) {\n                                        console.log(applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment));\n                                    }\n\n                                    return (\n                                        <tr key={index} >\n                                            <td>\n                                                <button type=\"button\" onClick={() => {\n                                                    if (applicant.coApplicantLastName && applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment) !== -1) {\n                                                        getLatestApplication({ applicantId: applicant.id, coApplicantFirstName: applicant.coApplicantFirstName, coApplicantLastName: applicant.coApplicantLastName }, applicant);\n                                                    } else {\n                                                        getLatestApplication({ applicantId: applicant.id }, applicant);\n                                                    }\n                                                }}>Select</button>\n                                            </td>\n                                            <td>{applicant.firstName}</td>\n                                            <td>{applicant.lastName}</td>\n                                            <td>{applicant.street}</td>\n                                            <td>{applicant.city}</td>\n                                            <td>{applicant.state}</td>\n                                            <td>{applicant.zip}</td>\n                                            <td>{applicant.email}</td>\n                                            <td>{applicant.phoneNumber}</td>\n                                            <td>{(applicant.coApplicantLastName && applicant.coApplicantLastName.indexOf(approvedApplicantLastNameFragment) !== -1) ? `${applicant.coApplicantFirstName || \"\"} ${applicant.coApplicantLastName || \"\"}` : \"\"}</td>\n                                        </tr>\n                                    );\n\n                                })}\n                            </tbody>\n                        </table>\n                    </>\n                )}\n                {/* {!state.latestApplication.id && !state.approvedApplicants.length && (<h3>There are not currently any approved applications.</h3>)} */}\n                {state.latestApplication.id && (\n                    <>\n                        <h3>Selected Application</h3>\n                        <div className=\"form-unit\">Application Number: {state.latestApplication.id}</div>\n                        <div className=\"form-unit\">Date: {new Date(state.latestApplication.date).toString()}</div>\n                        <div className=\"form-unit\">Applicant Name: {state.latestApplication.applicant.firstName} {state.latestApplication.applicant.lastName}</div>\n                        <div className=\"form-unit\">Applicant Address: {state.latestApplication.applicant.street}, {state.latestApplication.applicant.city}, {state.latestApplication.applicant.state}  {state.latestApplication.applicant.zipCode}</div>\n                        <div className=\"form-unit\">Email: {state.latestApplication.applicant.email}</div>\n                        <div className=\"form-unit\">Phone Number: {state.latestApplication.applicant.phoneNumber}</div>\n                        {(state.latestApplication.coApplicantFirstName || state.latestApplication.coApplicantLastName) && <div className=\"form-unit\">Co-Applicant: {state.latestApplication.coApplicantFirstName} {state.latestApplication.coApplicantLastName}</div>}\n                        <h3>Expenses</h3>\n                        {state.dog.expenses.map(expense => (\n                            <div className=\"form-unit\" key={expense.vendor + expense.date}>\n                                <div>Vendor: {expense.vendor}</div>\n                                <div>Amount: ${expense.amountInCents / 100}</div>\n                                <div>Description: {expense.description}</div>\n                                <div>Date: {expense.date}</div>\n                            </div>\n                        ))}\n                        <h3>Total Expenses: ${totalExpenses}</h3>\n                        <h3>Animal Control pays: ${animalControlPays}</h3>\n                        <h3>Adoption Fee: ${adoptionFeeDollars}.{adoptionFeeCents}</h3>\n                        <div>\n                            <label htmlFor=\"adoption-date\">Adoption Date:</label>\n                            <input type=\"date\" onChange={({ target }) => setState({ ...state, dateAdopted: target.value })} />\n                        </div>\n                        <div className=\"form-unit\">\n                            <span>I confirm every looks correct: </span><button type=\"button\" onClick={submitAdoption}>Complete Adoption</button><button type=\"button\" onClick={() => setState({ ...state, latestApplication: {}, adoptionDate: \"\" })}>Cancel</button><span style={{ color: \"red\", paddingLeft: \"10px\" }}>{state.errorMessage}</span>\n                        </div>\n                    </>\n                )}\n            </main>\n        </>\n    )\n\n\n}\n\nexport default AddAdoption;"]},"metadata":{},"sourceType":"module"}